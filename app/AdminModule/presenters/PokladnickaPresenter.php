<?phpnamespace App\AdminModule\Presenters;use Nette\Application\UI\Form;use Nette\Utils\Strings;use DbTable;/** * Prezenter pre spravu pokladnicky. *  * Posledna zmena(last change): 18.09.2015 * *	Modul: ADMIN *  * @author Ing. Peter VOJTECH ml. <petak23@gmail.com> * @copyright  Copyright (c) 2012 - 2015 Ing. Peter VOJTECH ml. * @license * @link       http://petak23.echo-msz.eu * @version 1.0.3a  */class PokladnickaPresenter extends \App\AdminModule\Presenters\BasePresenter {  /** Nazov prvku na zmazanie    * @var string */  public $zdroj_na_zmazanie = 'položku';  /**    * @inject   * @var DbTable\Pokladnicka */	public $pokladnicka;    /** @var string Podnadpis */  private $h4;  	public function actionDefault() {    $this->template->h4 = "Pridaj položku";    $this["pokladnickaForm"]->setDefaults(array(      'vklad' => 1,			'suma'	=> '0,00',    	'ucel'	=> '',      'created' => StrFTime("%Y-%m-%d %H:%M:%S", Time()),    ));	}	public function actionEdit($id) {		if (isset($id) && $id) {			if (($polozka = $this->pokladnicka->find($id)) !== FALSE) {				$this->h4 .= 'Editácia položky: '.$polozka->ucel;        $this["pokladnickaForm"]->setDefaults($polozka);        $this->setView("default");			} else { //Ak je vsetko OK priprav premenne        $this->flashRedirect('Pokladnicka:', 'Došlo k chybe. K id neexzistuje položka.', 'danger');			}		} else {      $this->flashRedirect('Pokladnicka:', 'Došlo k chybe. Neviem id položky.', 'danger');		} 	}  public function renderDefault() {    $this->template->pokladnicka = $this->pokladnicka->pokladnicka();    $this->template->h2 = 'Pokladnička:';    $this->template->h4 = $this->h4;  }  	/**	 * Add pokladnicka form component factory.	 * @return Nette\Application\UI\Form	 */	protected function createComponentPokladnickaForm() {		$form = new Form();		$form->addProtection();		$form->addText('suma', 'Suma:', 50, 80)				 ->addRule(Form::FILLED, 'Suma musí byť zadaná!');		$form->addText('ucel', 'Účel:', 50, 80)         ->addRule(Form::FILLED, 'Účel musí byť zadaný!');		$vklad = array(      '1' => 'vklad',      '-1' => 'výber',    );    $form->addRadioList('vklad', 'Pohyb:', $vklad);    $form->addHidden("id");    $form->addHidden("created");		$form->addSubmit('uloz', 'Ulož');		$form->onSuccess[] = $this->pokladnickaFormSubmitted;		return $form;	}	public function pokladnickaFormSubmitted($form) {		$values = $form->getValues(); 				//Nacitanie hodnot formulara    $id = ($values->id) ? $values->id : 0;		if ($values->id) { unset($values->id);}     if (isset($values->suma)){      $values->suma = Strings::replace($values->suma, '~,~', '.');    }		//Uloženie zmien    $uloz = $this->pokladnicka->uloz($values, $id);    if (isset($uloz['id'])) { //Ulozenie v poriadku      $this->flashRedirect('Pokladnicka:', 'Položka bola úspešne uložená!', 'success');    } else {													//Ulozenie sa nepodarilo      $this->flashMessage('Došlo k chybe a položka sa neuložila. Skúste neskôr znovu...', 'danger');    }	}  /** Funkcia pre spracovanie signálu vymazavania	  * @param int $id - id polozky v hlavnom menu		* @param string $nazov - nazov polozky z hl. menu - na zrusenie?		* @param string $druh - blizsia specifikacia, kde je to potrebne		*/	function confirmedDelete($id, $nazov, $druh = "")	{		if ($this->pokladnicka->zmaz($id) == 1) {$this->flashMessage('Položka bola úspešne vymazaná!', 'success');}    else {$this->flashMessage('Došlo k chybe a položka nebola vymazaná!', 'danger');}    if (!$this->isAjax()) {$this->redirect('Pokladnicka:');}  }}